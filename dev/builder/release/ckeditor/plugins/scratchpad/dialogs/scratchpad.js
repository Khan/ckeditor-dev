(function(){CKEDITOR.dialog.add("scratchpad",function(d){return{title:"Embed Scratchpad",minWidth:300,minHeight:100,contents:[{id:"general",label:"Settings",elements:[{type:"text",id:"src",label:"Scratchpad URL",validate:CKEDITOR.dialog.validate.notEmpty("The URL field cannot be empty."),required:!0,setup:function(a){a&&a.hasAttribute("src")&&(a=a.getAttribute("src"),a=a.replace(/\/embedded.*$/,""),this.setValue(a))},commit:function(a){var b=this.getValue(),b=b.replace(/\/$/,"");a.setAttribute("src",
b+"/embedded?embed=yes&article=yes")}},{type:"html",html:"<p style='font-size:0.8em;'>Example: <span style='font-family:monospace;'>https://www.khanacademy.org/cs/monocleman/5271990638215168</span></p>"},{type:"checkbox",id:"showOnlyCanvas",label:"Show only canvas (no editor or buttons).",setup:function(a){a&&a.hasAttribute("src")&&/editor=(\w+)/.test(a.getAttribute("src"))&&this.setValue("no"===RegExp.$1);var b=this;this.getInputElement().on("change",function(){b.getDialog().setValueOf("general",
"height",b.getValue()?"400":"440");b.getDialog().setValueOf("general","width",b.getValue()?"400":"810")})},commit:function(a){var b=this.getValue()?"no":"yes",c=a.getAttribute("src");a.setAttribute("src",c+"&editor="+b+"&buttons="+b+"&author="+b)}},{type:"hbox",children:[{type:"text",id:"width",label:"Width","default":"810",validate:CKEDITOR.dialog.validate.notEmpty("The width field cannot be empty."),required:!0,requiredContent:"iframe[width]",setup:function(a){a&&a.hasAttribute("width")&&this.setValue(a.getAttribute("width"))},
commit:function(a,b,c){b=this.getValue();c.width=b;a.setAttribute("width",b);this.getDialog().getValueOf("general","showOnlyCanvas")&&(c=a.getAttribute("src"),a.setAttribute("src",c+"&width="+b))}},{type:"text",id:"height",label:"Height","default":"440",validate:CKEDITOR.dialog.validate.notEmpty("The height field cannot be empty."),required:!0,requiredContent:"iframe[height]",setup:function(a){a&&a.hasAttribute("height")&&this.setValue(a.getAttribute("height"))},commit:function(a,b,c){b=this.getValue();
c.height=b;a.setAttribute("height",b);this.getDialog().getValueOf("general","showOnlyCanvas")&&(c=a.getAttribute("src"),a.setAttribute("src",c+"&height="+b))}}]}]}],onShow:function(){this.fakeImage=this.iframeNode=null;var a=this.getSelectedElement();a&&"scratchpad"===a.data("cke-real-element-type")?(this.fakeImage=a,this.iframeNode=a=d.restoreRealElement(a),this.setupContent(a)):this.setupContent()},onOk:function(){var a={},b={},c=this.fakeImage?this.iframeNode:new CKEDITOR.dom.element("iframe");
this.commitContent(c,a,b);c.setAttributes({"class":"scratchpad",frameBorder:"0",scrolling:"no"});c=d.createFakeElement(c,"scratchpad","scratchpad",!1);c.setAttributes(b);c.setStyles(a);this.fakeImage?(c.replace(this.fakeImage),d.getSelection().selectElement(c)):d.insertElement(c)}}})})();